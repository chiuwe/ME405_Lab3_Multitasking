<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Inter-task communication tests: Inter-task communication tests</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Inter-task communication tests
   &#160;<span id="projectnumber">0.4</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Inter-task communication tests </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This program implements a set of tests to verify that the ME405 library's inter-task communication works. It's also a usable example of how the queues and shared data items are used. In addition, it helps to show why non thread safe data transfer is a bad idea; there is a global variable used to pass data between two tasks, and as the program runs, the global variable sometimes gets corrupted.</p>
<p>The task diagram for this program is shown below. </p>
<div align="center">
<img src="dot_inline_dotgraph_1.png" alt="dot_inline_dotgraph_1.png" border="0" usemap="#dot_inline_dotgraph_1.map"/>
<map name="dot_inline_dotgraph_1.map" id="dot_inline_dotgraph_1.map"><area shape="rect" id="node1" href="classtask__multi.html" title="MultiTask 1\nPri: 1\n10&#45;137 ms" alt="" coords="5,139,96,194"/><area shape="rect" id="node6" href="classtask__user.html" title="User Interface\nPri: 0\n1 ms" alt="" coords="190,273,295,327"/><area shape="rect" id="node2" href="classtask__multi.html" title="MultiTask 2\nPri: 1\n10&#45;137 ms" alt="" coords="133,139,224,194"/><area shape="rect" id="node3" href="classtask__multi.html" title="MultiTask N\nPri: 1\n10&#45;137 ms" alt="" coords="261,139,352,194"/><area shape="rect" id="node4" href="classtask__sink.html" title="Data Sink\nPri: 2\n0&#45;20 ms" alt="" coords="395,139,475,194"/><area shape="rect" id="node5" href="classtask__source.html" title="Data Source\nPri: 2\n1 ms" alt="" coords="387,6,483,61"/></map>
</div>
<p> There are a couple of unusual features on this task diagram. The number of "multi-tasks" can be varied by changing <code>N_MULTI_TASKS</code> in <code><a class="el" href="test__main_8cpp.html#a840291bc02cba5474a4cb46a9b9566fe">main()</a></code>. These multi-tasks are a bunch of tasks, all created from the same class, that are used to put some stress on the RTOS by running lots of tasks at the same time. The multi-task's timing includes a delay of random duration; this timing scheme causes tasks to pre-empt each other with random timing. The data sink task normally runs very quickly, looking for changed data; if it finds data, it delays by 20 ms to give other tasks some time to run. The data sink therefore takes up a lot of CPU time, and one can see that the user interface runs slowly because of this.</p>
<p>When this program is running, one can press the "v" key in a terminal window to cause the program to display a task status report. A typical report is shown below. </p>
<div class="fragment"><div class="line">Task                            Stack</div>
<div class="line">Name            Pri.    State   Free/Total      Runs</div>
<div class="line">----            ----    -----   ----------      ----</div>
<div class="line">Multi3          1       0       63/120          0        153 runs</div>
<div class="line">Multi2          1       0       63/120          0        161 runs</div>
<div class="line">Multi1          1       0       63/120          0        157 runs</div>
<div class="line">Multi0          1       0       63/120          0        152 runs</div>
<div class="line">UserInt         1       0       66/240          0        4217 runs</div>
<div class="line">Sink            2       0       92/160          0       1136446 runs, errors in queue: 0, shared_data: 0, global data: 265</div>
<div class="line">Source          2       0       145/220         0        10446 runs</div>
<div class="line">IDLE            0       -       50/100</div>
<div class="line">Heap: 4000/5944, OCR5A=1999</div>
</div><!-- fragment --><p> This report shows tasks and their current priorities and states. Also, for the data sink task, it shows a report of how accurately the data from the data source task has been received. One should see that there have been no errors in sending data through the queue or shared data item, but the use of a global variable has caused errors due to task switching while the data was being written or read. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Apr 10 2014 12:01:51 for Inter-task communication tests by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
